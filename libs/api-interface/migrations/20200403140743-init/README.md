# Migration `20200403140743-init`

This migration has been generated by Pavlo Strunkin at 4/3/2020, 2:07:43 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Role" AS ENUM ('CUSTOMER', 'ADMIN');

CREATE TYPE "TestSessionState" AS ENUM ('PENDING', 'UNRESOLVED', 'ACCEPTED', 'DECLINED');

CREATE TABLE "public"."User" (
    "active" boolean  NOT NULL DEFAULT false,
    "apiKey" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "email" text  NOT NULL ,
    "forename" text   ,
    "id" text  NOT NULL ,
    "lastname" text   ,
    "password" text  NOT NULL ,
    "role" "Role" NOT NULL DEFAULT 'CUSTOMER',
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Project" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "description" text   ,
    "id" text  NOT NULL ,
    "name" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Test" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" text  NOT NULL ,
    "name" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Variation" (
    "additionalData" text   ,
    "browserName" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "deviceName" text  NOT NULL ,
    "id" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."TestSession" (
    "autoBaseline" boolean  NOT NULL DEFAULT false,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "diffImageKey" text   ,
    "id" text  NOT NULL ,
    "imageKey" text   ,
    "isSameDimensions" boolean   ,
    "misMatchPercentage" Decimal(65,30)   ,
    "misMatchTolerance" Decimal(65,30)  NOT NULL ,
    "state" "TestSessionState" NOT NULL DEFAULT 'PENDING',
    "stateComment" text   ,
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "User.apiKey" ON "public"."User"("apiKey")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200403140743-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,93 @@
+// SQLite / Mysql / Postgres
+datasource db {
+  // https://github.com/prisma/prisma2/blob/master/docs/core/connectors
+  // mysql | sqlite | postgresql
+  provider = "postgresql"
+  url      = env("VK_DATABASE")
+}
+
+generator photon {
+  provider     = "prisma-client-js"
+  binaryTarget = ["native", "linux-glibc-libssl1.0.2"]
+  output       = "../../node_modules/@generated/photonjs"
+}
+
+model User {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  email    String  @unique
+  password String
+  lastname String?
+  forename String?
+  active   Boolean @default(false)
+  role     Role    @default(CUSTOMER)
+  apiKey   String  @unique
+}
+
+model Project {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  name        String
+  description String?
+  tests       Test[]
+}
+
+model Test {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  name       String
+  project    Project
+  variations Variation[]
+}
+
+model Variation {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  browserName String
+  deviceName  String
+  test        Test
+
+  testSessions   TestSession[]
+  additionalData String?
+  baseline       TestSession?  @relation(name: "VariationBaseline")
+}
+
+model TestSession {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  diffImageKey       String?
+  imageKey           String?
+  misMatchPercentage Float?
+  misMatchTolerance  Float
+  isSameDimensions   Boolean?
+  variation          Variation
+  state              TestSessionState @default(PENDING)
+  stateChangedByUser User?
+  stateComment       String?
+  autoBaseline       Boolean          @default(false)
+
+  // baseline reference
+  baselineRef Variation? @relation(name: "VariationBaseline")
+}
+
+enum Role {
+  CUSTOMER
+  ADMIN
+}
+
+enum TestSessionState {
+  PENDING
+  UNRESOLVED
+  ACCEPTED
+  DECLINED
+}
```


