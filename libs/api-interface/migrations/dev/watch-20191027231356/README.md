# Migration `watch-20191027231356`

This migration has been generated by Mitko Tschimev at 10/27/2019, 11:13:57 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql

```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration ..watch-20191027231356
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,100 @@
+datasource db {
+  provider = "postgresql"
+  url      = env("VK_POSTGRES_URL")
+}
+
+generator photon {
+  provider     = "photonjs"
+  binaryTarget = ["native", "linux-glibc-libssl1.0.2"]
+  output       = "../../node_modules/@generated/photonjs"
+}
+
+generator photon_layer {
+  provider     = "photonjs"
+  binaryTarget = ["linux-glibc-libssl1.0.2"]
+  output       = "../../layers/photon/nodejs/node_modules/@generated/photonjs"
+}
+
+model User {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  email    String  @unique
+  password String
+  lastname String?
+  forename String?
+  active   Boolean @default(false)
+  role     Role    @default(CUSTOMER)
+  apiKey   String  @unique
+}
+
+model Project {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  name        String
+  description String?
+  tests       Test[]
+}
+
+model Test {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  name       String
+  project    Project
+  variations Variation[]
+}
+
+model Variation {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  browserName String
+  deviceName  String
+  test        Test
+
+  testSessions   TestSession[]
+  additionalData String?
+  baseline       TestSession?  @relation(name: "VariationBaseline")
+}
+
+model TestSession {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  diffImageKey       String?
+  imageKey           String?
+  misMatchPercentage Float?
+  misMatchTolerance  Float
+  isSameDimensions   Boolean?
+  variation          Variation
+  state              TestSessionState @default(PENDING)
+  stateChangedByUser User?
+  stateComment       String?
+  autoBaseline       Boolean          @default(false)
+
+  // baseline reference
+  baselineRef Variation? @relation(name: "VariationBaseline")
+
+  // reference to the diff
+  baselineForDiffRef TestSession? @relation(name: "DiffBaselineOnTestSession")
+  diffBaseline       TestSession? @relation(name: "DiffBaselineOnTestSession")
+}
+
+enum Role {
+  CUSTOMER
+  ADMIN
+}
+
+enum TestSessionState {
+  PENDING
+  UNRESOLVED
+  ACCEPTED
+  DECLINED
+}
```

## Photon Usage

You can use a specific Photon built for this migration (watch-20191027231356)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/watch-20191027231356'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
