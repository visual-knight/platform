# Migration `20200406223811-init123`

This migration has been generated by Filtering is added at 4/6/2020, 10:38:11 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."TestSession_baselineRefId"

ALTER TABLE "public"."TestSession" DROP CONSTRAINT IF EXiSTS "TestSession_baselineRefId_fkey",
DROP COLUMN "baselineRefId";

ALTER TABLE "public"."Variation" ADD COLUMN "baselineId" text   ;

CREATE UNIQUE INDEX "Variation_baselineId" ON "public"."Variation"("baselineId")

ALTER TABLE "public"."Variation" ADD FOREIGN KEY ("baselineId")REFERENCES "public"."TestSession"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200406223105-init12..20200406223811-init123
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 datasource db {
   // https://github.com/prisma/prisma2/blob/master/docs/core/connectors
   // mysql | sqlite | postgresql
   provider = "postgresql"
-  url = "***"
+  url      = env("VK_DATABASE")
 }
 generator photon {
   provider     = "prisma-client-js"
@@ -58,9 +58,10 @@
   testId      String
   testSessions   TestSession[]
   additionalData String?
-  baseline       TestSession?  @relation(name: "VariationBaseline")
+  baseline       TestSession?  @relation(name: "VariationBaseline", fields: [baselineId], references: [id])
+  baselineId     String?
 }
 model TestSession {
   id        String   @id @default(cuid())
@@ -78,10 +79,9 @@
   stateChangedByUser User?
   stateComment       String?
   autoBaseline       Boolean          @default(false)
-  baselineRef     Variation? @relation(name: "VariationBaseline", fields: [baselineRefId], references: [id])
-  baselineRefId   String?
+  baselineRef     Variation? @relation(name: "VariationBaseline")
 }
 enum Role {
   CUSTOMER
```


