# Migration `20200406190638-init`

This migration has been generated by Filtering is added at 4/6/2020, 7:06:38 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Test" ;

ALTER TABLE "public"."TestSession" ;

ALTER TABLE "public"."Variation" ;

ALTER TABLE "public"."Test" ADD FOREIGN KEY ("projectId")REFERENCES "public"."Project"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."TestSession" ADD FOREIGN KEY ("variationId")REFERENCES "public"."Variation"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Variation" ADD FOREIGN KEY ("testId")REFERENCES "public"."Test"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Variation" ADD FOREIGN KEY ("baselineId")REFERENCES "public"."TestSession"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200406190638-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,94 @@
+// SQLite / Mysql / Postgres
+datasource db {
+  // https://github.com/prisma/prisma2/blob/master/docs/core/connectors
+  // mysql | sqlite | postgresql
+  provider = "postgresql"
+  url      = env("VK_DATABASE")
+}
+
+generator photon {
+  provider     = "prisma-client-js"
+  binaryTarget = ["native", "linux-glibc-libssl1.0.2"]
+  output       = "../../node_modules/@generated/photonjs"
+}
+
+model User {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  email    String  @unique
+  password String
+  lastname String?
+  forename String?
+  active   Boolean @default(false)
+  role     Role    @default(CUSTOMER)
+  apiKey   String  @unique
+}
+
+model Project {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  name        String
+  description String?
+  tests       Test[]
+}
+
+model Test {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  name       String
+  project    Project @relation(fields: [projectId], references: [id])
+  projectId  Int 
+  variations Variation[]
+}
+
+model Variation {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  browserName String
+  deviceName  String
+  test        Test   @relation(fields: [testId], references: [id])
+  testId      Int
+
+  testSessions   TestSession[]
+  additionalData String?
+  baseline       TestSession?  @relation(name: "VariationBaseline", fields: [baselineId], references: [id])
+  baselineId     Int?
+}
+
+model TestSession {
+  id        String   @id @default(cuid())
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+
+  diffImageKey       String?
+  imageKey           String?
+  misMatchPercentage Float?
+  misMatchTolerance  Float
+  isSameDimensions   Boolean?
+  variation          Variation        @relation(fields: [variationId], references: [id])
+  variationId        Int
+  state              TestSessionState @default(PENDING)
+  stateChangedByUser User?
+  stateComment       String?
+  autoBaseline       Boolean          @default(false)
+}
+
+enum Role {
+  CUSTOMER
+  ADMIN
+}
+
+enum TestSessionState {
+  PENDING
+  UNRESOLVED
+  ACCEPTED
+  DECLINED
+}
```


